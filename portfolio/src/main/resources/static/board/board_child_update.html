<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<!-- 모바일에서 사이트접속을 위한 반응형 웹 선언-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>자식 게시판 수정</title>
<!-- jQuery Setting -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- jQuery Setting -->
<!-- js Setting -->
<script src="/js/common/jwt_token_refresh/jwt_auth.js"></script>
<script src="/js/common/board/board.js"></script>
<script src="/js/common/visitor/visitor.js"></script>
<script src="/js/board/board_common.js"></script>
<!-- js Setting -->
<!-- CSS Setting -->
<link rel="stylesheet" href="/css/common/common_header.css">
<link rel="stylesheet" href="/css/board/board_update.css">
<link rel="stylesheet" href="/css/common/common_footer.css">
<!-- CSS Setting -->
</head>
<body>
	<header id="header">
	    <div class="header-top">
	        <div id="logo"><a href="/">Log</a></div>
	        <div id="user-actions">
	            <button id="login-btn">로그인</button>
	            <button id="register-btn">회원가입</button>
	        </div>
	    </div>
	    <nav id="board-tabs">
	        <ul id="parent-boards"></ul>
	    </nav>
	</header>

	<main>
		<h2>부모 게시판 수정</h2>
	
	    <form id="childBoardUpdateForm">
	        <label for="boardName">게시판 이름</label><br>
	        <input type="text" id="boardName" name="name" placeholder="게시판 이름 입력"><br>

	        <label for="boardDesc">게시판 설명</label><br>
	        <textarea id="boardDesc" name="description" placeholder="게시판 설명 입력"></textarea><br>

	        <label for="isActive">활성 상태</label>
	        <input type="checkbox" id="isActive" name="isActive"><br><br>

	        <label for="sortOrder">정렬 순서</label>
	        <input type="number" id="sortOrder" name="sortOrder" placeholder="숫자로 입력"><br>

			<label for="parentNumber">부모 게시판 번호</label>
			<input type="number" id="parentNumber" name="parentNumber" placeholder="숫자로 입력"><br>
	        <button type="submit" onsubmit="return false;">수정하기</button>
	    </form>
	
	    <div id="update-result" style="margin-top:20px;"></div>
	</main>

	<footer id="main-footer">
	    <div class="footer-container">
	        <div class="footer-stats">
	            <span>오늘 접속자: <strong id="today-visitors">0</strong></span>
	            <span>한 달 접속자: <strong id="month-visitors">0</strong></span>
	        </div>
	        <div class="footer-spacer"></div>
	    </div>
	</footer>
</body>
<script>
	//*************************************************** 변수 START ***************************************************//
	//*************************************************** 변수 End ***************************************************//
	//*************************************************** 페이지 초기화 START ***************************************************//
	check_child_board();
	//*************************************************** 페이지 초기화 End ***************************************************//

	//*************************************************** Function Start ***************************************************//
	function check_child_board() {
		if(!parentBoardIds.includes(boardId) && !noticeBoard.includes(boardId)) {
			getBoardInfo();
			board_update();
		}else {
	        alert("잘못된 접근입니다. 일반 게시판이 아닙니다.");
	        window.location.href = "/";
	    }
	}
	//*************************************************** Function End ***************************************************//

	// 게시판 정보 조회
	function getBoardInfo() {
	    if (!boardId || isNaN(boardId)) {
	    	alert("올바른 boardId가 필요합니다."); 
	    	return; 
	    }
	    $.getJSON(`/boards/${boardId}`, function(board) {
	        $("#boardName").val(board.name);           // input value
	        $("#boardDesc").val(board.description);    // textarea value
	        $("#isActive").prop("checked", board.active); // checkbox checked
	        $("#sortOrder").val(board.sortOrder);      // input value
	        $("#parentNumber").val(board.boardId);
	    }).fail(function(xhr) {
	        console.error("게시판 단건 조회 실패:", xhr.responseText);
	    });
	}
	
	function board_update() {
		// 수정 폼 제출
	    $("#childBoardUpdateForm").on("submit", function(e) {
	        e.preventDefault();
			console.log(boardId);
	        const payload = {
	            name: $("#boardName").val() || null,
	            description: $("#boardDesc").val() || null,
	            active: $("#isActive").is(":checked"),
	            sortOrder: $("#sortOrder").val() ? Number($("#sortOrder").val()) : null,
	            parentBoardId: $("#parentNumber").val() ? Number($("#parentNumber").val()) : null
	        };

	        ajaxWithToken({
	            url: `/boards/admin/${boardId}`,
	            method: "PATCH",
	            contentType: "application/json",
	            data: JSON.stringify(payload),
	            success: function(res) {
	                $("#update-result").html(`<span style="color:green;">수정 성공: ${res.name}</span>`);
	            },
	            error: function(xhr) {
	                $("#update-result").html(`<span style="color:red;">수정 실패: ${xhr.responseText}</span>`);
	            }
	        });
	    });
	}
</script>
</html>