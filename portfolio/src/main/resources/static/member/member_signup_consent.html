<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>약관 동의</title>
<!-- 모바일에서 사이트접속을 위한 반응형 웹 선언-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- jQuery Setting -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- js Setting -->
<script src="/js/common/member/member_signin_signup_button.js"></script>
<script src="/js/common/board/board.js"></script>
<script src="/js/common/visitor/visitor.js"></script>
<!-- CSS Setting -->
<link rel="stylesheet" href="css/common/common_header.css">
<link rel="stylesheet" href="css/member/member_signup_consent/member_signup_consent.css">
<link rel="stylesheet" href="css/member/member_footer.css">
</head>
<body>
	<!-- 헤더 영역 -->
	<header id="header">
		<!-- 첫 번째 줄 -->
		<div class="header-top">
			<div id="logo">
    			<a href="/">Log</a>
			</div>
			<!-- 오른쪽 사용자 메뉴 -->
			<div id="user-actions">
				<button id="login-btn">로그인</button>
				<button id="register-btn">회원가입</button>
			</div>
		</div>

		<nav id="board-tabs">
			<ul id="parent-boards">
			<!-- 게시판 -->
			</ul>
		</nav>
	</header>
	<!-- 메인 바디 영역(회원가입) -->
	<main>
    <h2>회원가입을 위해 약관에 동의해주세요</h2>
    <form id="consent-form">
        <!-- 전체 동의 -->
        <div class="consent-item">
            <div class="checkbox-row">
                <input type="checkbox" id="check-all">
                <label for="check-all"><strong>전체 동의</strong></label>
            </div>
        </div>

        <!-- 이용약관 -->
        <div class="consent-item">
            <div class="checkbox-row">
                <input type="checkbox" id="terms" name="consents" value="TERMS_OF_SERVICE">
                <label for="terms">이용약관 동의 (필수)</label>
            </div>
            <p>서비스 이용을 위해 필요한 약관으로, 사이트 이용 시 준수해야 하는 규칙과 책임을 안내합니다.</p>
        </div>

        <!-- 개인정보 처리방침 -->
        <div class="consent-item">
            <div class="checkbox-row">
                <input type="checkbox" id="privacy" name="consents" value="PRIVACY_POLICY">
                <label for="privacy">개인정보 처리방침 동의 (필수)</label>
            </div>
            <p>회원의 개인정보 수집, 이용, 보관, 파기 방식과 권리를 안내하며, 안전한 개인정보 보호를 위해 필수 동의가 필요합니다.</p>
        </div>

        <!-- 마케팅 -->
        <div class="consent-item">
            <div class="checkbox-row">
                <input type="checkbox" id="marketing" name="consents" value="MARKETING">
                <label for="marketing">마케팅/광고 수신 동의 (선택)</label>
            </div>
            <p>이벤트, 프로모션, 맞춤형 광고 정보 등을 이메일이나 문자로 수신하는 것에 대한 선택적 동의입니다.</p>
        </div>

        <button type="button" id="next-btn">회원가입으로 이동</button>
    </form>
	</main>
	<!-- 푸터 영역 -->
	<footer id="main-footer">
	    <div class="footer-stats">
	        <span>오늘 접속자: <strong id="today-visitors">0</strong></span>
	        <span>한 달 접속자: <strong id="month-visitors">0</strong></span>
	    </div>
	    <div class="footer-spacer"></div>
	</footer>
</body>
</html>

<script>

	//*************************************************** 변수 START ***************************************************//

	// 전체 동의 체크박스
	var checkAll = $("#check-all");
	// 다음버튼
	var nextBtn = $("#next-btn");
	// 필수 동의
	var requiredConsents = ["TERMS_OF_SERVICE", "PRIVACY_POLICY"];

	//*************************************************** 변수 End ***************************************************//

	//*************************************************** 페이지 초기화  Start ***************************************************//

	/* 페이지 로드 시 초기 상태 */
	toggleNextButton();
	
	/* 뒤로가기/앞으로가기 시 체크 상태 기반으로 버튼 활성화 */
	$(window).on('pageshow', function(event) {
	    // 체크박스 상태에 따라 전체동의 체크 여부 갱신
	    var allChecked = $("input[name='consents']").length === $("input[name='consents']:checked").length;
	    checkAll.prop("checked", allChecked);

	    // 다음 버튼 활성화/비활성화
	    toggleNextButton();
	});

	/* 전체 동의 체크박스 */
	all_cheked();
	/* 체크 박스 선택할 때 마다, 다음 버튼 활성화 여부 체크 */
	cheked_update();
	/* 필수 체크박스 또는 전체 동의시 다음 페이지로 이동 */
	next_signup();

	//*************************************************** 페이지 초기화  Start ***************************************************//

	// 전체 동의 체크/해제
	function all_cheked() {
	    checkAll.on("change", function() {
	        var isChecked = $(this).is(":checked");
	        $("input[name='consents']").prop("checked", isChecked);
	        toggleNextButton();
	    });
	}

	// 각 체크박스 클릭 시 버튼 상태 업데이트
	function cheked_update() {
	    $("input[name='consents']").on("change", function() {
	        toggleNextButton();
	        // 개별 체크박스가 모두 체크되면 전체동의도 체크됨
	        var allChecked = $("input[name='consents']").length === $("input[name='consents']:checked").length;
	        checkAll.prop("checked", allChecked);
	    });
	}

	// 다음 버튼 활성/비활성 함수
	function toggleNextButton() {
		// 체크 박스 필수 요소(TERMS_OF_SERVICE", "PRIVACY_POLICY) 체크시 다음 버튼 활성화를 위해 필요한 변수
	    var allRequiredChecked = true;

		// requiredConsents = ["TERMS_OF_SERVICE", "PRIVACY_POLICY"];
	    requiredConsents.forEach(function(value) {
	    	// value = TERMS_OF_SERVICE", "PRIVACY_POLICY 태그가 체크가 안되어있으면 
	        if (!$("input[value='" + value + "']").is(":checked")) {
	        	// 버튼 비활성화
	            allRequiredChecked = false;
	        }
	    });

	    // 다음 버튼 비활성화
	    nextBtn.prop("disabled", !allRequiredChecked);
	}

	function next_signup() {
		// 다음 버튼 클릭 시 체크된 동의 항목 sessionStorage에 저장 후 회원가입 페이지로 이동
		nextBtn.on("click", function() {
								   // 체크된 input 태그 요소 가져온 후
		    var selectedConsents = $("input[name='consents']:checked")
		    					   // map으로 태그 -> value로 리턴(Jquery 객체)
		                           .map(function() { return this.value; })
		                           // value(Jquery객체) -> value(자바스크립트)
		                           .get();
	
		    // Json.stringify = JS객체 -> JSON문자열
		    // 세션스토리지에 key(consents), value(Json(selectedConsents)) 으로 저장
		    sessionStorage.setItem("consents", JSON.stringify(selectedConsents));
		    // 회원가입 페이지 이동
		    window.location.href = "/signup";
		});
	}

</script>
