<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<!-- ëª¨ë°”ì¼ì—ì„œ ì‚¬ì´íŠ¸ì ‘ì†ì„ ìœ„í•œ ë°˜ì‘í˜• ì›¹ ì„ ì–¸-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë©”ì¸ ì¸ê¸° ê²Œì‹œê¸€</title>
<!-- jQuery Setting -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- js Setting -->
<!-- Common -->
<script src="/js/common/jwt_token_refresh/jwt_auth.js"></script>
<script src="/js/common/member/member_signin_signup_button.js"></script>
<script src="/js/common/board/board.js"></script>
<script src="/js/common/visitor/visitor.js"></script>
<script src="/js/common/board/search.js"></script>
<script src="/js/main_post.js"></script>
<script src="/js/main_post_page.js"></script>
<!-- Common -->
<!-- CSS Setting Start -->
<link rel="stylesheet" href="/css/common/common_header.css">
<link rel="stylesheet" href="/css/main/main_post.css">
<link rel="stylesheet" href="/css/main/main_post_comment.css">
<link rel="stylesheet" href="/css/main/main_post_board.css">
<link rel="stylesheet" href="/css/main/main_page_button.css">
<link rel="stylesheet" href="/css/common/common_footer.css">
<!-- CSS Setting End-->
</head>
<body>
	
	<!-- header Start -->
	<header id="header">
		<!-- ì²« ë²ˆì§¸ ì¤„ -->
		<div class="header-top">
			<div id="logo">
    			<a href="/">Log</a>
			</div>
			<!-- ì˜¤ë¥¸ìª½ ì‚¬ìš©ì ë©”ë‰´ -->
			<div id="user-actions">
				<button id="login-btn">ë¡œê·¸ì¸</button>
				<button id="register-btn">íšŒì›ê°€ì…</button>
			</div>
		</div>

		<nav id="board-tabs">
			<ul id="parent-boards">
			<!-- ê²Œì‹œíŒ ì˜ì—­  -->
			</ul>
		</nav>
	</header>
	<!-- header End -->

	<!-- ë©”ì¸ ë°”ë”” ì˜ì—­(ë©”ì¸ ì¸ê¸° ê²Œì‹œê¸€) -->
	<main>
		<div id="main_post">
			<!-- ë©”ì¸ ì¸ê¸° ê²Œì‹œê¸€(post) ë³´ì—¬ì£¼ê¸° -->
			<section id="main_post_section">
				<!-- ê³µí†µìœ¼ë¡œ ë¹¼ê¸° -->
				<!-- ê²Œì‹œê¸€ ë‹¨ í•œê±´ì´ë¯€ë¡œ, '<article></article> íƒœê·¸  -->
				<article id="post_detail">
					<header class="post_header">
						<h1 id="post_title">ê²Œì‹œê¸€ ì œëª©</h1> <!-- script 'id'ì‚¬ìš© -->
						<!-- ê²Œì‹œê¸€ ë©”íƒ€ë°ì´í„°(ê²Œì‹œíŒ,ì‘ì„±ì, ì‘ì„±ì ì‘ì„±ì¼, ì¡°íšŒìˆ˜, ì¢‹ì•„ìš”... -->
						<p id="post_meta">
							ì‘ì„±ì: <span id="post_author">ì‘ì„±ì</span> | <!-- script 'id'ì‚¬ìš© -->
							ì¡°íšŒìˆ˜: <span id="post_views">0</span> <br> <!-- script 'id'ì‚¬ìš© -->
							ê²Œì‹œíŒ: <span id="post_board">ê²Œì‹œíŒ ì´ë¦„</span> | <!-- script 'id'ì‚¬ìš© -->
				        	ì‘ì„±ì¼: <span id="post_created">2025-08-28 15:00</span>  <!-- script 'id'ì‚¬ìš© -->
				      	</p>
				    </header>

					<!-- ë³¸ë¬¸ ì˜ì—­-->
					<div id="post_content_images">
						<div id="post_content"> <!-- script 'id'ì‚¬ìš© -->
							ê²Œì‹œê¸€ ë‚´ìš©ì´ ë“¤ì–´ê°€ëŠ” ì˜ì—­
						</div>
						<!-- ì´ë¯¸ì§€ ì˜ì—­ -->
						<div id="post_images"> <!-- script 'id'ì‚¬ìš© -->
							<!-- <img src="ì´ë¯¸ì§€URL" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€"> í˜•íƒœë¡œ jQuery ë Œë”ë§ -->
						</div>
					</div>

					<!-- ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì˜ì—­ (ì´ë¯¸ì§€ ìˆì„ë•Œë§Œ ë³´ì—¬ì£¼ê¸°(show())-->
					<div id="post_images_download" style="display: none"> <!-- script 'id'ì‚¬ìš© -->
						<!-- <img src="ì´ë¯¸ì§€URL" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€"> í˜•íƒœë¡œ jQuery ë Œë”ë§ -->
					</div>

					<!-- ì¢‹ì•„ìš” ì˜ì—­ -->
					<div id="post_reactions">
					  <button id="post_btn_like">ğŸ‘ ì¢‹ì•„ìš” <span id="post_likes">0</span></button> <!-- script 'id'ì‚¬ìš© --> 
					  <button id="post_btn_dislike">ğŸ‘ ì‹«ì–´ìš” <span id="post_dislikes">0</span></button> <!-- script 'id'ì‚¬ìš© -->
					</div>
				</article>
				<!-- ê³µí†µìœ¼ë¡œ ë¹¼ê¸° -->
			</section>
			<!-- 2. ëŒ“ê¸€ ì„¹ì…˜ ìë¦¬  ê³µí† ìœ¼ë¡œ ë¹¼ê¸°-->
			<section id="comments_section">
				<div id="post_comments_header">
					<div id="comments_count">ëŒ“ê¸€: <span id="post_comments">0</span></div>
					<select id="comment_sort">
	            		<option value="normal">ì›ë˜ëŒ€ë¡œ</option>
	            		<option value="recent">ìµœì‹ ìˆœ</option>
	            		<option value="like">ì¢‹ì•„ìš”ìˆœ+ìµœì‹ ìˆœ</option>
	        		</select>
        		</div>
        		<div id="comment_list_body">
	        		<div id="all_commnet_list">
		        		<div id="popular_comments_list">
							<!-- ì¸ê¸° ëŒ“ê¸€ì€ ë‚˜ì¤‘ì— jQueryë¡œ ë Œë”ë§ -->
						</div>
						<div id="comments_list">
							<!-- ëŒ“ê¸€ì€ ë‚˜ì¤‘ì— jQueryë¡œ ë Œë”ë§ -->
						</div>
	        		</div>
        		</div>
				<div id="commet_write_footer">
				    <div id="comment_write_section">
				        <div class="textarea_wrapper">
				            <textarea id="new_comment_content" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
				            <button id="btn_add_comment">ëŒ“ê¸€ ì‘ì„±</button>
				        </div>
				    </div>
				</div>
			</section>
			<!-- <!-- 2. ëŒ“ê¸€ ì„¹ì…˜ ìë¦¬  ê³µí† ìœ¼ë¡œ ë¹¼ê¸°-->
		</div>

		<!-- ë©”ì¸ ì¸ê¸° ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ Start -->
		<section id="popular-posts">
			<h2>[ğŸ”¥HOTğŸ”¥]ë©”ì¸ ì¸ê¸° ê²Œì‹œê¸€</h2>
			<ul id = "popular-posts-container">
				  <!-- jQueryë¡œ ê²Œì‹œê¸€ ì¶”ê°€ -->
			</ul>
			<!-- í˜ì´ì§• ë²„íŠ¼ ì˜ì—­ -->
    		<div id="pagination-container">
        		<button id="first-page">ì²˜ìŒ</button>
        		<button id="jump-backward">&lt;&lt;</button>
        		<button id="prev-page">ì´ì „</button>
        		<span id="page-buttons"><!-- í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„± --></span>
        		<button id="next-page">ë‹¤ìŒ</button>
        		<button id="jump-forward">&gt;&gt;</button>
        		<button id="last-page">ë§ˆì§€ë§‰</button>
    		</div>
		</section>
		<!-- ë©”ì¸ ì¸ê¸° ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ End -->
	</main>

	<!-- footer Start -->
	<footer id="main-footer">
		<div class="footer-container">
			<!-- ì ‘ì†ì ì˜ì—­ -->
			<div class="footer-stats">
				<span>ì˜¤ëŠ˜ ì ‘ì†ì: <strong id="today-visitors">0</strong></span>
				<span>í•œ ë‹¬ ì ‘ì†ì: <strong id="month-visitors">0</strong></span>
			</div>
        	<!-- ì¤‘ì•™: ê²€ìƒ‰ì°½ -->
        	<div class="footer-search">
        		<select id="searchType">
        			<option value="keyword">ì œëª©/ë³¸ë¬¸</option>
        			<option value="author">ì‘ì„±ì</option>
        			<option value="autocomplete" hidden>ìë™ì™„ì„±</option> <!-- hidden ì²˜ë¦¬ -->
        		</select>
		    <div class="autocomplete-wrapper">
		        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." />
		        <ul id="autocomplete-list" class="autocomplete-items"></ul>
		    </div>
            	<button class="search-btn">ğŸ”</button>
        	</div>
        	    <!-- ì˜¤ë¥¸ìª½: ê· í˜•ìš© ìŠ¤í˜ì´ì„œ -->
    		<div class="footer-spacer"></div>
    	</div>
	</footer>
	<!-- footer End -->
</body>

<script>
	//*************************************************** ë³€ìˆ˜ START ***************************************************//
	
	const popular_posts_container = $("#popular-posts-container");

	var currentKeyword = '';   // ê²€ìƒ‰ì–´ ì €ì¥
	var currentSearchType = 'keyword'; // ê²€ìƒ‰ íƒ€ì…

	//*************************************************** ë³€ìˆ˜ End ***************************************************//

	//*************************************************** í˜ì´ì§€ ì´ˆê¸°í™”  Start ***************************************************//

	/* Board API Start */
	/* main API í˜¸ì¶œ */
	getMain(0);
	/* ì‹¤ì‹œê°„ ê²€ìƒ‰ APIí˜¸ì¶œ */
	RealTimeSearch();
	/* Board API End */
	//*************************************************** í˜ì´ì§€ ì´ˆê¸°í™”  Start ***************************************************//

	//*************************************************** Function START ***************************************************//
	//*************************************************** Function End ***************************************************//

	//*************************************************** Post ëœë”ë§ Start ***************************************************//

	function renderPost(post) {
		$("#post_title").text("[ğŸ”¥HOTğŸ”¥] " + post.title);
		$("#post_board").text(post.boardName);
		$("#post_views").text(post.viewCount);
		$("#post_author").text(post.userNickname);
		$("#post_created").text(post.createdAt);
		$("#post_likes").text(post.likeCount);
		$("#post_dislikes").text(post.dislikeCount);
		$("#post_content").html(post.content);

	    if (post.imageUrls && post.imageUrls.length > 0) {
	        post.imageUrls.forEach(url => {
	        	$("#post_images").append(`<img src="${url}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€">`);
	        });
	        shwo_image_download(post.imageUrls);
	    }
	}

	//*************************************************** Post ëœë”ë§ End ***************************************************//
	//*************************************************** Commnet ëœë”ë§ Start ***************************************************//



	//*************************************************** Commnet ëœë”ë§ Start ***************************************************//

	//*************************************************** Board ëœë”ë§ START ***************************************************//
	
	function renderPosts(posts) {

	    if(check_posts(posts)) {
			popular_posts_container.append(no_posts_tag(no_main_popularList));
     		return;
	    }

	    posts.forEach(function(post) {
	        var thumbnailHtml = '';
	        if (post.thumbnailImageUrl && post.thumbnailImageUrl.trim() !== '') {
	            thumbnailHtml = `<img src="${post.thumbnailImageUrl}" alt="ì¸ë„¤ì¼" class="post-thumbnail">`;
	        }

	        var postCard =`
	        				<li class = "post-card">
	        					<a href="/main_post/${post.postId}" class ="post-link">
	        						${thumbnailHtml}
	        						<div class="post-info">
	        							<h3 class ="post-title">[ğŸ”¥HOTğŸ”¥] ${post.title}</h3>
	        							<p class = "post-meta">
	        								ì‘ì„±ì: ${post.userNickname} | ì¢‹ì•„ìš”: ${post.reactionCount} | ëŒ“ê¸€: ${post.commentCount} <br>
	        								ê²Œì‹œíŒ: ${post.boardName} | ì¡°íšŒìˆ˜: ${post.viewCount} | ì‘ì„±ì¼ì: ${post.createdAt}
	        							</p>
	        						</div>
	        					</a>
	        				</li>
				          `;

	        popular_posts_container.append(postCard);
	    });
	}

	//*************************************************** Board ëœë”ë§ End ***************************************************//
	//*************************************************** ëœë”ë§ End ***************************************************//

	//*************************************************** API START ***************************************************//
	//*************************************************** Post API START ***************************************************//

	//*************************************************** Post API End ***************************************************//

	// ê²Œì‹œê¸€ í˜¸ì¶œ API
	function getPostDetail() {
		$("#post_title").empty();
		$("#post_board").empty();
		$("#post_author").empty();
		$("#post_created").empty();
		$("#post_views").empty();
		$("#post_likes").empty();
		$("#post-dislikes").empty();
		$("#post_content").empty();
		$("#post_images").empty();
		$("#post_images_download").empty();
		
		// ajaxì˜µì…˜ ê°ì²´ ì…‹íŒ…
		$.ajax({
			url: `/posts/${postId}`,
			method: 'GET',
			success: function(post) {
				if(post) {
					renderPost(post);
				}else {
					return;
				}
			},
			error: function(err) {
				console.log("ê²Œì‹œê¸€ ì¡°íšŒ ì‹¤íŒ¨: " + err.responseText);
			}
		})
	}

	//*************************************************** Board API START ***************************************************//
	// ë©”ì¸ ì¸ê¸°ê¸€ API(í˜ì´ì§€ ë„˜ê¸¸ë•Œ ë§ˆë‹¤ í˜¸ì¶œ)
	function getMain(page = 0) {
	
		/* í˜ì´ì§• ë³€í™”ì‹œ ìƒì„¸ ê²Œì‹œê¸€ ì•ˆë³´ì—¬ì£¼ê¸°
		if(page !==0) {
			page_check  = true;
		}

		if(page_check) {
			main_post.empty();
		}
		*/ 

		popular_posts_container.empty();

		currentMode = 'post';
	
		$.ajax({
			url : `/main/popular-posts?page=${page}`, // ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ API
			method : 'GET',				// ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ HTTP í”„ë¡œí† ì½œ
			success : function (data) {
	
				var mainDataLength = data.posts.length;
	
				if(mainDataLength === 0) {
					renderPosts(data.posts)
				} else {
					renderPosts(data.posts || []);
				}
				renderPagination(data);
			},
			error: function(xhr) {
			        popular_posts_container.append(no_posts_tag(no_main_popularList));
			        renderPagination(errorPage);
			    alert(xhr.responseText || "");
			}
		});
	}

	// ë‚˜ì¤‘ì— API ê°ˆì•„ì•¼í•¨ ì¸ê¸°ê²Œì‹œê¸€ìš© (ì‘ì„±ì,ë‹‰ë„¤ì„, ì‹¤ì‹œê°„ ê²€ìƒ‰ìœ¼ë¡œ)
	// ê²€ìƒ‰ API
	function executeSearch(page = 0) {

		currentKeyword  = $("#searchInput").val().trim(); //ì œëª©+ë³¸ë¬¸ or ì‘ì„±ì
		currentSearchType = $("#searchType").val();


		// ê²€ìƒ‰ì–´ë¥¼ ëª…ì‹œí•˜ì§€ ì•Šì„ì‹œ
		if(!currentKeyword) {
			alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
			return;
		}

	    if (currentKeyword.length < 2) {
	        alert("ê²€ìƒ‰ì–´ëŠ” ìµœì†Œ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");
	        return;
	    }

	    currentMode = 'search';

		var url = "";

	    if (currentSearchType === "keyword") {
	        // í‚¤ì›Œë“œ ê²€ìƒ‰ (ì¿¼ë¦¬ìŠ¤íŠ¸ë§(/search?))
	    	url = `/main/popular_posts/keyword/search?keyword=${encodeURIComponent(currentKeyword)}&page=${page}`;
	    } else if (currentSearchType === "author") {
	        // ì‘ì„±ì ê²€ìƒ‰ (PathVariable)
	    	url = `/main/popular_posts/author/search/${encodeURIComponent(currentKeyword)}?page=${page}`;
	    } else if(currentSearchType === "autocomplete") {
	    	// ìë™ì™„ì„± ê²€ìƒ‰ 
	    	url = `/main/popular_posts/autocomplete/title/search?title=${encodeURIComponent(currentKeyword)}`;
	    }
		
		/* ì „ì²´ í†µí•© ê²€ìƒ‰ì— ì‚¬ìš©
	    if (currentSearchType === "keyword") {
	        // í‚¤ì›Œë“œ ê²€ìƒ‰ (ì¿¼ë¦¬ìŠ¤íŠ¸ë§(/search?))
	    	url = `/posts/search?keyword=${encodeURIComponent(currentKeyword)}&page=${page}`;
	    } else if (currentSearchType === "author") {
	        // ì‘ì„±ì ê²€ìƒ‰ (PathVariable)
	    	url = `/posts/author/${encodeURIComponent(currentKeyword)}?page=${page}`;
	    } else if(currentSearchType === "autocomplete") {
	    	// ìë™ì™„ì„± ê²€ìƒ‰ 
	    	url = `/posts/autocomplete/search?keyword=${encodeURIComponent(currentKeyword)}`
	    }
		*/

		popular_posts_container.empty();

		$.ajax({
			url : url,
			method : "GET",
			success: function(data) {

	            // ì œëª© ë³€ê²½: ê²€ìƒ‰ ê²°ê³¼ì¼ ê²½ìš°
	            $("#popular-posts h2").text(`ê²€ìƒ‰ ê²°ê³¼: "${currentKeyword}"`);

				if(data.posts && data.posts.length > 0) {
					renderPosts(data.posts || []);
					renderPagination(data);
				}else {
					popular_posts_container.append(no_posts_tag(no_searchList));
					renderPagination(data);
				}
				
			},
			error: function(xhr) {
				popular_posts_container.append(no_posts_tag(no_searchList));
				renderPagination(errorPage);
			    alert(xhr.responseText || "");
			}
		})
	}

	// ì‹¤ì‹œê°„ ê²€ìƒ‰ API 
	function RealTimeSearch() {

		if(currentSearchType !== 'keyword'){
			return; // ì‘ì„±ì ê²€ìƒ‰ ì‹œ ìë™ì™„ì„± ë¹„í™œì„±í™”
		}

		// ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ íƒœê·¸ 
		const list = $("#autocomplete-list");

	    $("#searchInput").on("input", function() {
	        clearTimeout(debounceTimer);
	        // ì œëª©+ë³¸ë¬¸ input íƒœê·¸ value ê°€ì ¸ì˜¨ í›„ ì•ë’¤ ê³µë°±ì œê±°
	        const keyword = $(this).val().trim();

	        // í‚¤ì›Œë“œê°€ ì¡´ì¬ í•˜ì§€ ì•Šê±°ë‚˜ 2ê¸€ì ë¯¸ë§Œì¼ê²½ìš° ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ í˜¸ì¶œ X
	        if(!keyword || keyword.length < 2) {
	        	list.empty().hide();
	            return;
	        }

	        // window.setTimeout() ë©”ì„œë“œ í˜¸ì¶œ API ì‹¤í–‰í›„ (0.5ì´ˆ) í›„ ì¬ì‹¤í–‰
	        debounceTimer = window.setTimeout(() => {
	            $.ajax({
	                url: `/main/popular_posts/autocomplete/search?keyword=${encodeURIComponent(keyword)}`,
	                method: "GET",
	                success: function(data) {
	                    list.empty();
	                    if(data.length === 0) {
	                        list.hide();
	                        return;
	                    }
						// ë°ì´í„°ê°€ ìˆë‹¤ë©´
	                    data.forEach(title => {
	                    	// <li>ì œëª©+ë³¸ë¬¸ ì‹¤ì‹œê°„ íƒ€ì´í‹€</li>íƒœê·¸ ìƒì„±
	                        const item = $(`<li>${title}</li>`);
	                    	// <li></li> íƒœê·¸ í´ë¦­ì‹œ
	                        item.on("click", function() {
	                        	// ê²€ìƒ‰ì°½ inputíƒœê·¸ì— valueë¥¼ íƒ€ì´í‹€ ë¶€ì—¬
	                            $("#searchInput").val(title);
	                        	// ê²€ìƒ‰ íƒ€ì…ì„ ìë™ì™„ì„± íƒ€ì…ìœ¼ë¡œ ë¶€ì—¬
	                            $("#searchType").val("autocomplete");
	                        	// ë¦¬ìŠ¤íŠ¸ ë¹„ì›Œê³  ê°€ë ¤ì¤€ ë‹¤ìŒì—
	                            list.empty().hide();
	                        	// <li>íƒœê·¸ í´ë¦­ì‹œ ë°”ë¡œ ê²€ìƒ‰ API í˜¸ì¶œ
	                            executeSearch(0); 
	                        });
	                    	// '#autocomplete-list'.append(<li>${title}</li>);
	                        list.append(item);
	                    });
						// "#autocomplete-list" ë³´ì—¬ì£¼ê¸°
	                    list.show();
	                },
	                error: function(xhr) {
	                    console.error(xhr);
	                }
	            });
	        }, 500); // 300ms ë””ë°”ìš´ìŠ¤
	    });
	}

	//*************************************************** Board API End ***************************************************//
	//*************************************************** API End ***************************************************//
</script>
</html>